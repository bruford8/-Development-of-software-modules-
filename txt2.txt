import sys
from PyQt6.QtCore import *
from PyQt6.QtWidgets import *
from PyQt6.QtGui import *


class Autorization(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("ANK Software")
        self.settings = QSettings("ANK Software", "ThemeSettings")
        saved_theme = self.settings.value("theme", "light")
        self.apply_theme(saved_theme)

        central_widget = QWidget()
        self.setCentralWidget(central_widget)

        main_layout = QVBoxLayout(central_widget)
        main_layout.setAlignment(Qt.AlignmentFlag.AlignCenter)

        self.label = QLabel("Autorization")
        self.label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        font = QFont()
        font.setPointSize(15)
        self.label.setFont(font)
        main_layout.addWidget(self.label)

        self.autorization1 = QLineEdit("управляющий")
        self.autorization2 = QLineEdit("09112001")
        self.autorization2.setFixedSize(350, 22)
        self.autorization1.setFixedSize(350, 22)
        self.autorization2.setEchoMode(QLineEdit.EchoMode.Password)
        self.autorization1.setPlaceholderText("Login")
        self.autorization2.setPlaceholderText("Password")
        main_layout.addWidget(self.autorization1)
        main_layout.addWidget(self.autorization2)

        self.button_auth = QPushButton("Login")
        self.button_auth.clicked.connect(self.check_credentials)
        main_layout.addWidget(self.button_auth)

    def check_credentials(self):
        username = self.autorization1.text()
        password = self.autorization2.text()

        if username == "управляющий" and password == "09112001":
            self.open_main_window()
        else:
            QMessageBox.warning(self, "Error", "Wrong login, or password!")

    def open_main_window(self):
        self.main_window = MainWindow()
        self.main_window.show_maximized()
        self.close()

    def show_maximized(self):
        self.show()
        self.showMaximized()

    def apply_theme(self, theme):
        self.apply_theme_to_app(theme)

    @staticmethod
    def apply_theme_to_app(theme):
        if theme == "dark":
            dark_palette = QPalette()
            dark_palette.setColor(QPalette.ColorRole.Window, QColor(53, 53, 53))
            dark_palette.setColor(QPalette.ColorRole.WindowText, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.Base, QColor(25, 25, 25))
            dark_palette.setColor(QPalette.ColorRole.AlternateBase, QColor(53, 53, 53))
            dark_palette.setColor(QPalette.ColorRole.ToolTipBase, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.ToolTipText, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.Text, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.Button, QColor(53, 53, 53))
            dark_palette.setColor(QPalette.ColorRole.ButtonText, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.BrightText, Qt.GlobalColor.red)
            dark_palette.setColor(QPalette.ColorRole.Link, QColor(42, 130, 218))
            dark_palette.setColor(QPalette.ColorRole.Highlight, QColor(42, 130, 218))
            dark_palette.setColor(QPalette.ColorRole.HighlightedText, Qt.GlobalColor.black)
            QApplication.instance().setPalette(dark_palette)
        else:
            QApplication.instance().setPalette(QApplication.style().standardPalette())


class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("ANK Software")
        self.settings = QSettings("ANK Software")
        saved_theme = self.settings.value("theme", "light")
        self.apply_theme(saved_theme)

        central_widget = QWidget()
        self.setCentralWidget(central_widget)

        main_layout = QVBoxLayout(central_widget)
        main_layout.setAlignment(Qt.AlignmentFlag.AlignTop)

        main_layout.setAlignment(Qt.AlignmentFlag.AlignLeft)

        menu_bar = self.menuBar()

        manager_menu = menu_bar.addMenu("Manager")
        shift_report = manager_menu.addAction("Shift report")
        exit_action = manager_menu.addAction("Exit")
        exit_action.triggered.connect(self.open_autorization_window)
        shift_report.triggered.connect(self.open_shift_report)

        tools_menu = menu_bar.addMenu("Tools")
        settings_menu = tools_menu.addAction("Settings")
        settings_menu.triggered.connect(self.open_settings_window)

        help_menu = menu_bar.addMenu("Help")
        user_guide_menu = help_menu.addAction("User Guide")
        about_menu = help_menu.addAction("About")
        support_menu = help_menu.addAction("Support")

        self.computers = QPushButton("Computers")
        self.computers.setFixedSize(200, 40)
        main_layout.addStretch()
        main_layout.addWidget(self.computers)

        self.computers = QPushButton("Sales")
        self.computers.setFixedSize(200, 40)
        main_layout.addWidget(self.computers)

        self.computers = QPushButton("Users")
        self.computers.setFixedSize(200, 40)
        main_layout.addWidget(self.computers)

        self.computers = QPushButton("Manage")
        self.computers.setFixedSize(200, 40)
        main_layout.addWidget(self.computers)

        self.computers = QPushButton("Deployment")
        self.computers.setFixedSize(200, 40)
        main_layout.addWidget(self.computers)

        self.computers = QPushButton("Monitoring")
        self.computers.setFixedSize(200, 40)
        main_layout.addWidget(self.computers)

        self.computers = QPushButton("Reports")
        self.computers.setFixedSize(200, 40)
        main_layout.addWidget(self.computers)

        self.computers = QPushButton("Log")
        self.computers.setFixedSize(200, 40)
        main_layout.addWidget(self.computers)

    def open_autorization_window(self):
        self.autorization = Autorization()
        self.autorization.show_maximized()
        self.close()

    def open_settings_window(self):
        self.settings_window = Settings()
        self.settings_window.show_maximized()
        self.close()

    def open_shift_report(self):
        self.shift_report = ShiftReport()
        self.shift_report.show_maximized()
        self.close()

    def apply_theme(self, theme):
        Autorization.apply_theme_to_app(theme)

    def show_maximized(self):
        self.show()
        self.showMaximized()


class Settings(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("ANK Software")

        self.settings = QSettings("ANK Software")
        self.current_theme = self.settings.value("theme", "light")
        self.current_style = self.settings.value("style", "Windows")

        self.apply_theme_and_style(self.current_theme, self.current_style)

        central_widget = QWidget()
        self.setCentralWidget(central_widget)

        main_layout = QVBoxLayout(central_widget)
        main_layout.setAlignment(Qt.AlignmentFlag.AlignTop)

        menu_bar = self.menuBar()
        tools_menu = menu_bar.addMenu("Tools")
        back_action = tools_menu.addAction("Back")
        back_action.triggered.connect(self.open_main_window)

        title_label = QLabel("Settings")
        title_label.setAlignment(Qt.AlignmentFlag.AlignLeft)
        font = QFont()
        font.setPointSize(18)
        title_label.setFont(font)
        main_layout.addWidget(title_label)

        color_theme_label = QLabel("Light/Dark themes")
        color_theme_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        font = QFont()
        font.setPointSize(14)
        color_theme_label.setFont(font)
        main_layout.addWidget(color_theme_label)

        theme_group = QGroupBox()
        theme_group.setFixedSize(250, 80)
        theme_layout = QVBoxLayout()

        self.light_theme_btn = QPushButton("Light theme")
        self.dark_theme_btn = QPushButton("Dark theme")

        self.light_theme_btn.clicked.connect(lambda: self.change_color_theme("light"))
        self.dark_theme_btn.clicked.connect(lambda: self.change_color_theme("dark"))

        theme_layout.addWidget(self.light_theme_btn)
        self.light_theme_btn.setFixedSize(225, 20)
        theme_layout.addWidget(self.dark_theme_btn)
        self.dark_theme_btn.setFixedSize(225, 20)
        theme_group.setLayout(theme_layout)

        main_layout.addWidget(theme_group)

        style_label = QLabel("Style themes")
        style_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        font = QFont()
        font.setPointSize(14)
        style_label.setFont(font)
        main_layout.addWidget(style_label)

        self.style_combo = QComboBox()
        self.style_combo.addItems(['Fusion', 'Windows'])
        self.style_combo.setCurrentText(self.current_style)
        self.style_combo.setFixedSize(250, 30)
        main_layout.addWidget(self.style_combo)

        self.apply_btn = QPushButton('Confirm Style')
        self.apply_btn.setFixedSize(250, 25)
        main_layout.addWidget(self.apply_btn)

        self.apply_btn.clicked.connect(self.change_style)

    def change_color_theme(self, theme):
        self.current_theme = theme
        self.settings.setValue("theme", theme)
        self.apply_theme_and_style(theme, self.current_style)

    def change_style(self):
        style = self.style_combo.currentText()
        self.current_style = style
        self.settings.setValue("style", style)
        self.apply_theme_and_style(self.current_theme, style)

    def apply_theme_and_style(self, theme, style):
        app = QApplication.instance()

        app.setStyle(style)

        if theme == "dark":
            dark_palette = QPalette()
            dark_palette.setColor(QPalette.ColorRole.Window, QColor(53, 53, 53))
            dark_palette.setColor(QPalette.ColorRole.WindowText, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.Base, QColor(25, 25, 25))
            dark_palette.setColor(QPalette.ColorRole.AlternateBase, QColor(53, 53, 53))
            dark_palette.setColor(QPalette.ColorRole.ToolTipBase, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.ToolTipText, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.Text, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.Button, QColor(53, 53, 53))
            dark_palette.setColor(QPalette.ColorRole.ButtonText, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.BrightText, Qt.GlobalColor.red)
            dark_palette.setColor(QPalette.ColorRole.Link, QColor(42, 130, 218))
            dark_palette.setColor(QPalette.ColorRole.Highlight, QColor(42, 130, 218))
            dark_palette.setColor(QPalette.ColorRole.HighlightedText, Qt.GlobalColor.black)
            app.setPalette(dark_palette)
        else:
            app.setPalette(app.style().standardPalette())

    def open_main_window(self):
        self.main_window = MainWindow()
        self.main_window.show_maximized()
        self.close()

    def show_maximized(self):
        self.show()
        self.showMaximized()


class ShiftReport(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("ANK Software")

        self.settings = QSettings("ANK Software")
        self.current_theme = self.settings.value("theme", "light")
        self.current_style = self.settings.value("style", "Windows")

        self.apply_theme_and_style(self.current_theme, self.current_style)

        central_widget = QWidget()
        self.setCentralWidget(central_widget)

        main_layout = QVBoxLayout(central_widget)
        main_layout.setAlignment(Qt.AlignmentFlag.AlignCenter)

        main_layout.addStretch(1)

        self.label = QLabel("Report")
        self.label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        font = QFont()
        font.setPointSize(20)
        self.label.setFont(font)
        main_layout.addWidget(self.label)

        self.money = QLineEdit()
        self.money.setFixedSize(350, 35)
        self.money.setPlaceholderText("Cash")
        money_validator = QDoubleValidator(0.0, 999999.99, 2, self)
        money_validator.setNotation(QDoubleValidator.Notation.StandardNotation)
        self.money.setValidator(money_validator)
        main_layout.addWidget(self.money)

        self.terminal = QLineEdit()
        self.terminal.setFixedSize(350, 35)
        self.terminal.setPlaceholderText("Receipt")
        terminal_validator = QDoubleValidator(0.0, 999999.99, 2, self)
        terminal_validator.setNotation(QDoubleValidator.Notation.StandardNotation)
        self.terminal.setValidator(terminal_validator)
        main_layout.addWidget(self.terminal)

        self.remains = QLineEdit()
        self.remains.setFixedSize(350, 35)
        self.remains.setPlaceholderText("Remains")

        remains_validator = QDoubleValidator(0.0, 999999.99, 2, self)
        self.remains.setValidator(remains_validator)
        main_layout.addWidget(self.remains)

        self.end_shift = QPushButton("End shift")
        self.end_shift.clicked.connect(self.validate_and_open_main_window)
        main_layout.addWidget(self.end_shift)

        main_layout.addStretch(1)

    def validate_and_open_main_window(self):
        if not self.money.text().strip():
            QMessageBox.warning(self, "Error", "The cash field cannot be empty!")
            self.money.setFocus()
            return

        if not self.terminal.text().strip():
            QMessageBox.warning(self, "Error", "The receipt field cannot be empty!")
            self.terminal.setFocus()
            return

        try:
            cash_value = float(self.money.text())
            receipt_value = float(self.terminal.text())
        except ValueError:
            QMessageBox.warning(self, "Error", "Only numbers can be entered in the cash and receipt fields!")
            return

        self.open_main_window()

    def open_main_window(self):
        self.save_shift_data()

        self.main_window = MainWindow()
        self.main_window.show_maximized()
        self.close()

    def save_shift_data(self):
        cash = self.money.text()
        receipt = self.terminal.text()
        remains = self.remains.text() if self.remains.text().strip() else "0"

        print(f"Данные смены: Cash={cash}, Receipt={receipt}, Remains={remains}")

        self.settings.setValue("last_cash", cash)
        self.settings.setValue("last_receipt", receipt)
        self.settings.setValue("last_remains", remains)

    def show_maximized(self):
        self.show()
        self.showMaximized()

    def apply_theme_and_style(self, theme, style):
        app = QApplication.instance()

        app.setStyle(style)

        if theme == "dark":
            dark_palette = QPalette()
            dark_palette.setColor(QPalette.ColorRole.Window, QColor(53, 53, 53))
            dark_palette.setColor(QPalette.ColorRole.WindowText, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.Base, QColor(25, 25, 25))
            dark_palette.setColor(QPalette.ColorRole.AlternateBase, QColor(53, 53, 53))
            dark_palette.setColor(QPalette.ColorRole.ToolTipBase, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.ToolTipText, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.Text, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.Button, QColor(53, 53, 53))
            dark_palette.setColor(QPalette.ColorRole.ButtonText, Qt.GlobalColor.white)
            dark_palette.setColor(QPalette.ColorRole.BrightText, Qt.GlobalColor.red)
            dark_palette.setColor(QPalette.ColorRole.Link, QColor(42, 130, 218))
            dark_palette.setColor(QPalette.ColorRole.Highlight, QColor(42, 130, 218))
            dark_palette.setColor(QPalette.ColorRole.HighlightedText, Qt.GlobalColor.black)
            app.setPalette(dark_palette)
        else:
            app.setPalette(app.style().standardPalette())


if __name__ == "__main__":
    app = QApplication(sys.argv)

settings = QSettings("ANK Software")
initial_style = settings.value("style", "Fusion")
app.setStyle(initial_style)

window = Autorization()
window.show()
window.showMaximized()

sys.exit(app.exec())
